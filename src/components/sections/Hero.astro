---
import { Calculator } from "@lucide/astro";
import Button from "../ui/Button.astro";
import Section from "../ui/Section.astro";
import { heroData, iconMap, type BenefitData } from "../../data/index";

interface Benefit {
  icon: any;
  iconClass?: string;
  bgClass?: string;
  text: string;
}

interface Props {
  title?: string;
  highlight?: string;
  subtitle?: string;
  benefits?: Benefit[];
  buttonText?: string;
  buttonHref?: string;
  imageSrc?: string;
  secondaryButtonText?: string;
  secondaryButtonHref?: string;
  secondaryButtonVariant?: string;
  thirdTitleText?: string;
}

// Получаем данные из централизованного хранилища или из props
const defaultData = heroData;

const {
  title = defaultData.title,
  highlight = defaultData.highlight,
  subtitle = defaultData.subtitle,
  benefits: propBenefits,
  buttonText = defaultData.buttonText,
  buttonHref = defaultData.buttonHref,
  imageSrc = defaultData.imageSrc,
  secondaryButtonText = defaultData.secondaryButtonText,
  secondaryButtonHref = defaultData.secondaryButtonHref,
  secondaryButtonVariant = defaultData.secondaryButtonVariant,
  thirdTitleText = defaultData.thirdTitleText,
} = Astro.props;

// Преобразуем benefits из данных (с названиями иконок) в компоненты
// Если benefits переданы через props, проверяем нужно ли преобразовать иконки
// Иначе используем defaultData.benefits и преобразуем их
const benefits = (propBenefits || defaultData.benefits).map((benefit: any) => {
  // Если icon уже компонент (не строка), оставляем как есть
  // Если это строка, преобразуем в компонент
  if (typeof benefit.icon === 'string') {
    return {
      ...benefit,
      icon: iconMap[benefit.icon] || iconMap.Target, // fallback на Target если иконка не найдена
    };
  }
  return benefit;
});
---

<Section padding="xl" class="relative overflow-hidden">
  <!-- Decorative elements -->
  <div class="absolute inset-0 overflow-hidden pointer-events-none">
    <div
      class="absolute top-32 left-16 w-16 h-16 bg-yellow-100 rounded-full opacity-20"
    >
    </div>
    <div
      class="absolute top-48 right-24 w-24 h-24 bg-yellow-100 rounded-full opacity-15"
    >
    </div>
    <div
      class="absolute bottom-32 left-32 w-12 h-12 bg-yellow-100 rounded-full opacity-20"
    >
    </div>
  </div>

  <div class="relative grid lg:grid-cols-2 gap-8 lg:gap-12 items-center">
    <!-- Content -->
    <div class="space-y-6">
      <div class="space-y-5">
        <h1
          class="text-3xl md:text-4xl lg:text-5xl font-bold text-stone-800 leading-tight"
        >
          {title}
          <span
            class="text-transparent bg-clip-text bg-gradient-to-r from-yellow-400 to-amber-500"
          >
            {highlight}
          </span>
          {thirdTitleText}
        </h1>

        <p class="text-base md:text-lg text-stone-600 leading-relaxed max-w-xl">
          {subtitle}
        </p>
      </div>

      <!-- Benefits -->
      <div class="grid gap-3">
        {benefits.map((benefit) => (
          <div class="flex items-start space-x-3">
            <div
              class={`flex-shrink-0 w-6 h-6 ${benefit.bgClass ?? "bg-yellow-100"} rounded-lg flex items-center justify-center mt-0.5`}
            >
              <benefit.icon class={benefit.iconClass ?? "w-4 h-4 text-yellow-600"} />
            </div>
            <p class="text-sm text-stone-600 leading-relaxed">
              {benefit.text}
            </p>
          </div>
        ))}
      </div>

      <!-- CTA Button -->
      <div class="flex flex-col sm:flex-row gap-3 pt-2">
        {buttonText && (
          <Button
            href={buttonHref}
            variant="primary"
            size="md"
            class="flex justify-center items-center gap-2"
          >
            <Calculator class="w-4 h-4 aspect-square" />
            <span>{buttonText}</span>
          </Button>
        )}
        {secondaryButtonText && (
          <Button
            href={secondaryButtonHref}
            variant={(secondaryButtonVariant as "primary" | "secondary" | "outline") || "secondary"}
            size="md"
            class="flex justify-center items-center gap-2"
          >
            <span>{secondaryButtonText}</span>
          </Button>
        )}
      </div>
    </div>

    <!-- Hero Image Placeholder -->
    <div class="relative lg:order-first">
      <div
        class="aspect-[5/4] bg-gradient-to-br from-yellow-400 to-amber-500 rounded-2xl flex items-center justify-center overflow-hidden"
      >
        <img
          src={imageSrc}
          alt="Мероприятие"
          class="object-cover w-full h-full"
          loading="eager"
          decoding="async"
        />
      </div>

    </div>
  </div>
</Section>
