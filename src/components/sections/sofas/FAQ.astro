---
export interface FAQItem {
  question: string;
  answer: string;
}

export interface Props {
  faqs: FAQItem[];
  title?: string;
  id?: string;
  className?: string;
}

const {
  faqs = [],
  title = "Часто задаваемые вопросы",
  id = "faq",
  className = "max-w-3xl mx-auto py-20 px-4"
} = Astro.props;

// Генерируем JSON-LD для FAQPage
const faqJsonLd = {
  "@context": "https://schema.org",
  "@type": "FAQPage",
  "mainEntity": faqs.map(faq => ({
    "@type": "Question",
    "name": faq.question,
    "acceptedAnswer": {
      "@type": "Answer",
      "text": faq.answer
    }
  }))
};
---

<section
  id={id}
  class={className}
  aria-labelledby="faq-title"
  itemscope
  itemtype="https://schema.org/FAQPage"
>
  <script type="application/ld+json" set:html={JSON.stringify(faqJsonLd)}></script>
  <h2
    id="faq-title"
    class="text-3xl md:text-4xl font-bold text-stone-800 mb-10 text-center"
  >
    {title}
  </h2>
  <div class="divide-y divide-stone-200">
    {faqs.map((faq, i) => (
      <details
        class="group py-4 transition-colors"
        itemscope
        itemprop="mainEntity"
        itemtype="https://schema.org/Question"
        { ...(i === 0 ? { open: true } : {}) }
      >
        <summary
          class="flex items-center justify-between cursor-pointer select-none outline-none text-lg font-medium text-stone-800 group-open:text-amber-600 transition-colors"
          itemprop="name"
        >
          <span set:html={faq.question} />
          <svg
            class="w-5 h-5 ml-2 text-stone-400 group-open:rotate-180 transition-transform duration-300"
            fill="none"
            stroke="currentColor"
            stroke-width="2"
            viewBox="0 0 24 24"
            aria-hidden="true"
          >
            <path stroke-linecap="round" stroke-linejoin="round" d="M19 9l-7 7-7-7" />
          </svg>
        </summary>
        <div
          class="overflow-hidden transition-all duration-300 ease-in-out"
          itemscope
          itemprop="acceptedAnswer"
          itemtype="https://schema.org/Answer"
        >
          <div
            class="mt-3 text-stone-600 leading-relaxed"
            itemprop="text"
            set:html={faq.answer}
          />
        </div>
      </details>
    ))}
  </div>
  <style>
    details > summary::-webkit-details-marker { display: none; }
    details[open] > summary { color: #121212; }
    details > summary { transition: color 0.2s; }
    details > div {
      max-height: 0;
      opacity: 0;
      transition: max-height 0.3s cubic-bezier(.4,0,.2,1), opacity 0.3s;
    }
    details[open] > div {
      max-height: 500px;
      opacity: 1;
      transition: max-height 0.4s cubic-bezier(.4,0,.2,1), opacity 0.3s;
    }
  </style>
</section>
